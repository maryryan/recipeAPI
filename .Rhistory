recipeIDs <- recipeID.content[[2]]$recipe_id
recipeID.content
recipeIDs
ingredients <- list()
for( i in seq( length(recipeIDs) ) ){
details.reply <- getForm( recipeDetails.url,
key = food2fork.key,
rId = recipeIDs[i] )
details.content <- fromJSON( details.reply )
ingred.n <- length( details.content[[1]]$ingredients )
ingredients[[i]] <- cbind( rep(recipeIDs[i], ingred.n),
rep(details.content[[1]]$title, ingred.n),
details.content[[1]]$ingredients )
colnames( ingredients[[i]] ) <- c("RID", "Title", "Ingredients")
}
ingredients
#########################
############################## RECIPE API ANALYSIS
############################## MARY RYAN
############################## CREATED: 09.22.2019
############################## UPDATED:
#########################
#### LOAD LIBRARIES ####
library( rvest )
library( RCurl )
library( httr )
library( jsonlite )
options( stringsAsFactors = FALSE )
#### FOOD 2 FORK API ####
## SET UP HTML & KEY ##
## food2fork API ##
# https://www.food2fork.com/user/api #
# https://www.food2fork.com/about/api #
food2fork.key <- 'f6637a087cc80c8c50d1041a47a3a784'
recipeID.f2f.url <-  'https://www.food2fork.com/api/search'
recipeDetails.f2f.url <- 'https://www.food2fork.com/api/get'
## GET RECIPE IDS FROM API ##
query.f2f <- "taco"
recipeID.f2f.reply <- getForm( recipeID.url,
key = food2fork.key,
q = query )
recipeID.f2.content <- fromJSON( recipeID.f2f.reply )
recipeIDs.f2f <- recipeID.f2f.content[[2]]$recipe_id
## GET INGREDIENTS FROM RECIPE DETAILS API ##
ingredients.f2f <- list()
for( i in seq( length(recipeIDs.f2f) ) ){
details.f2f.reply <- getForm( recipeDetails.f2f.url,
key = food2fork.key,
rId = recipeIDs.f2f[i] )
details.f2f.content <- fromJSON( details.f2f.reply )
ingred.n <- length( details.f2f.content[[1]]$ingredients )
ingredients.f2f[[i]] <- cbind( rep(recipeIDs.f2f[i], ingred.n),
rep(details.f2f.content[[1]]$title, ingred.n),
details.f2f.content[[1]]$ingredients )
colnames( ingredients.f2f[[i]] ) <- c("RID", "Title", "Ingredients")
}
recipeID.f2f.reply <- getForm( recipeID.url,
key = food2fork.key,
q = query.f2f )
recipeID.f2f.reply <- getForm( recipeID.f2f.url,
key = food2fork.key,
q = query.f2f )
recipeID.f2.content <- fromJSON( recipeID.f2f.reply )
recipeIDs.f2f <- recipeID.f2f.content[[2]]$recipe_id
recipeID.f2f.content <- fromJSON( recipeID.f2f.reply )
recipeIDs.f2f <- recipeID.f2f.content[[2]]$recipe_id
length(recipeIDs.f2f)
ingredients.f2f <- list()
for( i in seq( length(recipeIDs.f2f) ) ){
details.f2f.reply <- getForm( recipeDetails.f2f.url,
key = food2fork.key,
rId = recipeIDs.f2f[i] )
details.f2f.content <- fromJSON( details.f2f.reply )
ingred.n <- length( details.f2f.content[[1]]$ingredients )
ingredients.f2f[[i]] <- cbind( rep(recipeIDs.f2f[i], ingred.n),
rep(details.f2f.content[[1]]$title, ingred.n),
details.f2f.content[[1]]$ingredients )
colnames( ingredients.f2f[[i]] ) <- c("RID", "Title", "Ingredients")
}
i <- 1
## GET INGREDIENTS FROM RECIPE DETAILS API ##
ingredients.f2f <- list()
details.f2f.reply <- getForm( recipeDetails.f2f.url,
key = food2fork.key,
rId = recipeIDs.f2f[i] )
details.f2f.content <- fromJSON( details.f2f.reply )
ingred.n <- length( details.f2f.content[[1]]$ingredients )
str(details.f2f.content)
recipeIDs.f2f
details.f2f.reply
getForm( recipeDetails.f2f.url,
key = food2fork.key,
rId = recipeIDs.f2f[1] )
getForm( recipeDetails.f2f.url,
key = food2fork.key,
rId = recipeIDs.f2f[2] )
str(recipeID.f2f.content)
recipeID.f2f.content[[2]]$title
recipeDetails.f2f.url <- 'https://www.food2fork.com/api/get'
i
getForm( recipeDetails.f2f.url,
key = food2fork.key,
rId = recipeIDs.f2f[i] )
OB.url <- 'https://api.openbrewerydb.org/breweries'
OB.tag <- 'patio'
OB.state <- 'california'
OB.city <- 'san_marcos'
OB.reply <- getForm( OB.url,
by_state = OB.state,
by_city = OB.city,
by_tag = OB.tag )
OB.reply
OB.reply <- getForm( OB.url,
by_state = OB.state)#,
OB.reply
OB.content <- fromJSON( OB.reply )
names(OB.content)
str(OB.content)
## Find some breweries in San Marcos, CA ##
#OB.tag <- 'patio'
OB.state <- 'california'
OB.city <- 'san_marcos'
OB.reply <- getForm( OB.url,
by_state = OB.state,
by_city = OB.city)
OB.content <- fromJSON( OB.reply )
OB.content[[1]]
OB.content
class(OB.content)
OB.content
OB.city <- 'escondido'
OB.reply <- getForm( OB.url,
by_state = OB.state,
by_city = OB.city)
OB.content <- fromJSON( OB.reply )
dim(OB.content)
OB.content
## Get all the tags that exist ##
OB.reply.gen <- getForm( OB.url )
OB.content.gen <- fromJSON( OB.reply.gen )
OB.tags.all <- unique( OB.content.gen$tag_list )
OB.tags.all
OB.content.gen
dim(OB.content.gen)
OB.reply <- getForm( OB.url,
by_state = OB.state,
by_city = OB.city)
OB.content <- fromJSON( OB.reply )
dim(OB.content)
getForm( OB.url,
by_state = OB.state,
by_city = OB.city, )
getForm( OB.url,
by_state = OB.state,
by_city = OB.city, by_tag = "patio" )
bloop <- getForm( OB.url,
by_state = OB.state,
by_city = OB.city, by_tag = "patio" )
dim(bloop)
dim(OB.reply.gen)
length(OB.reply.gen)
OB.reply.gen
length(bloop)
bloop.content <- fromJSON( bloop )
dim(bloop.content)
bloop.content
?is.null
OB.url <- 'https://api.openbrewerydb.org/breweries'
## Get all the tags that exist ##
OB.perPage <- 50
i <- 1
OB.tags.all <- list()
content.dim <- 1
while( !( is.null(content.dim) ) ){
OB.reply.gen <- getForm( OB.url,
page = i,
per_page = OB.perPage )
OB.content.gen <- fromJSON( OB.url )
content.dim <- dim( OB.content.gen )
if( !( is.null(content.dim) ) ){
OB.tags.all[[i]] <- unique( OB.content.gen$tag_list )
}
i <- i + 1
}
i
## Let's see what type of breweries we have in the North County area ##
northCounty.url <- GET( url = 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
?GET
## Let's see what type of breweries we have in the North County area ##
northCounty.url <- read_html( url = 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
northCounty.url
?html_nodes
## Let's see what type of breweries we have in the North County area ##
northCounty.html <- read_html( url = 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
NC_table <- html_nodes( northCountry.html )
## Let's see what type of breweries we have in the North County area ##
northCounty.html <- read_html( url = 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
NC_table <- html_nodes( northCounty.html )
northCounty.html
NC_table <- html_nodes( northCounty.html )
northCounty.url
northCounty.html
## Let's see what type of breweries we have in the North County area ##
northCounty.html <- GET( url = 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
northCountry.html
northCounty.html
NC_table <- html_nodes( northCounty.html )
str(northCounty.html)
NC.json <- fromJSON(northCounty.html)
names(northCounty.html)
northCounty.html$content
NC.json <- fromJSON( northCounty.html$content )
NC.raw <- rawToChar(northCounty.html$content)
NC.json <- fromJSON( NC.raw )
## Let's see what type of breweries we have in the North County area ##
northCounty.html <- getForm( url = 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
## Let's see what type of breweries we have in the North County area ##
northCounty.html <- getForm( 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
northCounty.html
NC.json <- fromJSON(northCounty.html$content)
northCounty.html$content
names(northCounty.html)
## Let's see what type of breweries we have in the North County area ##
northCounty.html <- read_html( 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
northCounty.html
?html_nodes
bloop <- northCounty.html %>%
html_nodes("ul")
bloop
bloop[1]
?html_table
bloop[7]
html_text(bloop[7])
NC.cities.nodes <- northCounty.html %>%
html_nodes("ul") %>%
html_text()
NC.cities.nodes <- trimws( NC.cities.nodes )
NC.cities.nodes
northCounty.html %>%
html_nodes("ul") %>%
html_text()[7]
NC.cities.nodes <- tr
northCounty.html %>%
html_nodes("ul") %>%
html_text()[7]
NC.cities.nodes <- trimws( NC.cities.nodes[7] )
NC.cities.nodes <- northCounty.html %>%
html_nodes("ul") %>%
html_text()
NC.cities.nodes <- trimws( NC.cities.nodes[7] )
NC.cities.nodes
NC.cities.nodes <- northCounty.html %>%
html_nodes("ul") %>%
html_text()
NC.IncorpCity.nodes <- trimws( NC.cities.nodes[7] )
NC.cities.nodes
NC.IncorpCity.nodes <- trimws( NC.cities.nodes[7] )
NC.UnIncorpCity.nodes <- trimws( NC.cities.nodes[8] )
NC.IncorpCity.nodes
NC.IncorpCity <-gsub("\n", "", NC.IncorpCity.nodes)
NC.UnIncorpCity <-gsub("\n", "", NC.UnIncorpCity.nodes)
NC.IncorpCity
?gsub
read.table(text = NC.IncorpCity.nodes, sep = "\n", as.is = TRUE)
?read.table
NC.IncorpCity.tbl <- read.table(text = NC.IncorpCity.nodes, sep = "\n", as.is = TRUE)
NC.IncorpCity.tbl
NC.IncorpCity.df <- sub("-.*", "", NC.IncorpCity.tbl)
NC.IncorpCity.df
sub(".*-.*", "", NC.IncorpCity.tbl)
sub("*-.*", "", NC.IncorpCity.tbl)
sub(".-.*", "", NC.IncorpCity.tbl)
gsub("*-.*$", "", NC.IncorpCity.tbl)
NC.IncorpCity.tbl
gsub("*-.*$", "", NC.IncorpCity.tbl[,1])
gsub("* -.*$", "", NC.IncorpCity.tbl[,1])
northCounty.html <- read_html( 'https://en.wikipedia.org/wiki/North_County_(San_Diego_area)#Cities')
NC.cities.nodes <- northCounty.html %>%
html_nodes("ul") %>%
html_text()
NC.IncorpCity.nodes <- trimws( NC.cities.nodes[7] )
NC.UnIncorpCity.nodes <- trimws( NC.cities.nodes[8] )
NC.IncorpCity.tbl <- read.table(text = NC.IncorpCity.nodes, sep = "\n", as.is = TRUE)
#gsub("*:.*$", "", "1:5") --> extract any character before :, which may have any character for any length after the : until the end of the string
NC.IncorpCity.df <- gsub("* -.*$", "", NC.IncorpCity.tbl[,1])
NC.UnIncorpCity.df <- gsub("* -.*$", "", NC.UnIncorpCity.tbl[,1])
NC.city.df <- c(NC.IncorpCity.df, NC.UnIncorpCity)
NC.UnIncorpCity.tbl <- read.table(text = NC.UnIncorpCity.nodes, sep = "\n", as.is = TRUE)
NC.UnIncorpCity.df <- gsub("* -.*$", "", NC.UnIncorpCity.tbl[,1])
NC.city.df <- c(NC.IncorpCity.df, NC.UnIncorpCity)
NC.city.df
NC.UnIncorpCity.tbl
gsub("* -.*$", "", NC.UnIncorpCity.tbl[,1])
NC.city.df <- c(NC.IncorpCity.df, NC.UnIncorpCity.df)
NC.city.df
OB.content
NC.city.df
# now we search the API for breweries in those cities #
OB.NC.content <- list()
for( i in seq( length(NC.city.df) ) ){
OB.NC.reply <- getForm( OB.url,
by_state = "california",
by_city = NC.city.df[i] )
OB.NC.content[[i]] <- fromJSON( OB.NC.reply )
}
OB.NC.content
OB.NC.content.df <- do.call( "rbind", OB.NC.content )
OB.NC.content.df
barplot( OB.NC.content.df$brewery_type )
OB.NC.content.df$brewery_type
table(OB.NC.content.df$brewery_type)
barplot( table(OB.NC.content.df$brewery_type) )
OB.NC.content.df %>%
ggplot( aes(brewery_type,
col=factor(city)) ) +
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type,
col=factor(city)) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
col=factor(city)) ) +
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, brewery_type,
col=factor(city)) ) +
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, count(brewery_type),
col=factor(city)) ) +
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type,
col=factor(city)) ) +
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type) )
OB.NC.content.df %>%
ggplot( aes(brewery_type) ) +
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type) ) + geom_bar()
OB.NC.content.df %>%
ggplot( aes(brewery_type) ) + #geom_bar()
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
?frequency
freq(OB.NC.content.df$brewery_type)
count(OB.NC.content.df$brewery_type)
OB.NC.content.df %>%
ggplot( aes(brewery_type, table(brewery_type),
col=factor(city)) ) + #geom_bar()
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, city,
col=factor(city)) ) + #geom_bar()
geom_bar( stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, brewery_type,
col=factor(city)) ) + #geom_bar()
geom_bar( stat = 'dodge',
aes( fill=factor(city) ) )
,
OB.NC.content.df %>%
ggplot( aes(brewery_type, brewery_type,
col=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(city, brewery_type,
col=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, city,
col=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df %>%
ggplot( aes(brewery_type, brewery_type,
col=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity',
aes( fill=factor(city) ) )
OB.NC.content.df
length(OB.NC.content.df)
OB.NC.content.df
OB.NC.content.df$value <- rep(1,length(OB.NC.content.df))
OB.NC.content.df$value <- rep( 1, dim(OB.NC.content.df)[1] )
OB.NC.content.df %>%
ggplot( aes(brewery_type, value,
col=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity',
aes( fill=factor(city) ) )
counts <- table(OB.NC.content.df$brewery_type, OB.NC.content.df$city)
counts
table(table(OB.NC.content.df$brewery_type, OB.NC.content.df$city))
?n
OB.NC.content.df <- OB.NC.content.df %>%
group_by( brewery_type, city ) %>%
mutate( count = n() )
OB.NC.content.df
OB.NC.content.df$n
OB.NC.content.df$count
OB.NC.content.df[1:10,c("city", "brewery_type","count")]
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' )
which(OB.NC.content.df$city == "Oceanside" & OB.NC.content.df$brewery_type== "micro")
length(which(OB.NC.content.df$city == "Oceanside" & OB.NC.content.df$brewery_type== "micro"))
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
geom_text(stat='count', aes(label=..count..), vjust=-1)
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' )
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
ylim(0, 13)
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
ylim(0, 15)
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
ylim(0, 14)
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_y_continuous(breaks=seq(2,14,2))
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_y_continuous(breaks=seq(2,14,2)) +
labs(title = "Breweries in North County, CA",
fill  = "City") +
xlab("Brewery Type") + ylab("")
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_y_continuous(breaks=seq(2,14,2)) +
labs(title = "Breweries in North County, CA",
fill  = "City") +
xlab("Brewery Type") + ylab("") +
theme_classic()
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_y_continuous(breaks=seq(2,14,2)) +
labs(title = "Breweries in North County, CA",
fill  = "City") +
xlab("Brewery Type") + ylab("") +
theme_light()
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_color_manual(values = c('#40004b','#762a83','#9970ab',
'#c2a5cf','#e7d4e8','#d9f0d3',
'#a6dba0','#5aae61','#1b7837','#00441b')) +
scale_y_continuous(breaks=seq(2,14,2)) +
labs(title = "Breweries in North County, CA",
fill  = "City") +
xlab("Brewery Type") + ylab("") +
theme_light()
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_fill_manual(values = c('#40004b','#762a83','#9970ab',
'#c2a5cf','#e7d4e8','#d9f0d3',
'#a6dba0','#5aae61','#1b7837','#00441b')) +
scale_y_continuous(breaks=seq(2,14,2)) +
labs(title = "Breweries in North County, CA",
fill  = "City") +
xlab("Brewery Type") + ylab("") +
theme_light()
OB.NC.content.df %>%
ggplot( aes(brewery_type, count,
fill=factor(city)) ) + #geom_bar()
geom_bar( position='dodge', stat = 'identity' ) +
scale_fill_manual(values = c('#8e0152','#c51b7d','#de77ae',
'#f1b6da','#fde0ef','#e6f5d0',
'#b8e186','#7fbc41','#4d9221','#276419')) +
scale_y_continuous(breaks=seq(2,14,2)) +
labs(title = "Breweries in North County, CA",
fill  = "City") +
xlab("Brewery Type") + ylab("") +
theme_light()
OB.NC.content.df[which(OB.NC.content.df$city == "Vista")]
OB.NC.content.df[which(OB.NC.content.df$city == "Vista"),]
OB.NC.content.df[which(OB.NC.content.df$city == "Vista"),"name"]
